package wire

import (
	"bytes"
	"encoding/hex"
	"reflect"
	"testing"
)

var (
	// BlockHeader
	tstGenesisHeaderDBBytes        = mustDecodeString("0a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstGenesisHeaderPacketBytes    = mustDecodeString("0a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstGenesisHeaderPlainBytes     = mustDecodeString("90140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstGenesisHeaderIDBytes        = mustDecodeString("90140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstGenesisHeaderWitnessIDBytes = mustDecodeString("")
	tstGenesisHeaderPoCIDBytes     = mustDecodeString("90140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000")
	tstGenesisHeaderChainIDBytes   = mustDecodeString("010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000")

	// FaultPubKey
	tstFaultPubKeyDBBytes        = mustDecodeString("08011ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7922d1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstFaultPubKeyPacketBytes    = mustDecodeString("08011ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7922d1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstFaultPubKeyPlainBytes     = mustDecodeString("010000000000000090140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7990140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstFaultPubKeyIDBytes        = mustDecodeString("010000000000000090140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7990140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79")
	tstFaultPubKeyWitnessIDBytes = mustDecodeString("")
	tstFaultPubKeyPoCIDBytes     = mustDecodeString("")
	tstFaultPubKeyChainIDBytes   = mustDecodeString("")

	// MsgBlock
	tstGenesisBlockDBBytes        = mustDecodeString("56010000000000000ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79120001000000000000005100000000000000080112130a080a0010ffffffff0f19ffffffffffffffff1a2a088080a3c34712220020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd22a0c000000000000000000000000")
	tstGenesisBlockPacketBytes    = mustDecodeString("0ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7912001a51080112130a080a0010ffffffff0f19ffffffffffffffff1a2a088080a3c34712220020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd22a0c000000000000000000000000")
	tstGenesisBlockPlainBytes     = mustDecodeString("90140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a79010000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00c06878040000000020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd20000000000000000000000000000000000000000")
	tstGenesisBlockIDBytes        = mustDecodeString("")
	tstGenesisBlockWitnessIDBytes = mustDecodeString("")
	tstGenesisBlockPoCIDBytes     = mustDecodeString("")
	tstGenesisBlockChainIDBytes   = mustDecodeString("")

	// MsgTx
	tstMsgTxDBBytes        = mustDecodeString("080112130a080a0010ffffffff0f19ffffffffffffffff1a2a088080a3c34712220020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd22a0c000000000000000000000000")
	tstMsgTxPacketBytes    = mustDecodeString("080112130a080a0010ffffffff0f19ffffffffffffffff1a2a088080a3c34712220020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd22a0c000000000000000000000000")
	tstMsgTxPlainBytes     = mustDecodeString("010000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00c06878040000000020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd20000000000000000000000000000000000000000")
	tstMsgTxIDBytes        = mustDecodeString("010000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00c06878040000000020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd20000000000000000000000000000000000000000")
	tstMsgTxWitnessIDBytes = mustDecodeString("010000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00c06878040000000020ba60494593fe65bea35fe9e118c129e5478ce660cec07c8ea8a7e2ec841fccd20000000000000000000000000000000000000000")
	tstMsgTxPoCIDBytes     = mustDecodeString("")
	tstMsgTxChainIDBytes   = mustDecodeString("")

	// NormalProposal
	tstNormalProposalDBBytes        = mustDecodeString("080110021a0f546869732069732061207465737421")
	tstNormalProposalPacketBytes    = mustDecodeString("080110021a0f546869732069732061207465737421")
	tstNormalProposalPlainBytes     = mustDecodeString("0100000002000000546869732069732061207465737421")
	tstNormalProposalIDBytes        = mustDecodeString("0100000002000000546869732069732061207465737421")
	tstNormalProposalWitnessIDBytes = mustDecodeString("")
	tstNormalProposalPoCIDBytes     = mustDecodeString("")
	tstNormalProposalChainIDBytes   = mustDecodeString("")

	// ProposalArea
	tstProposalAreaDBBytes        = mustDecodeString("0aaa0508011ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7922d1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a791215080110021a0f5468697320697320612074657374211215080110021a0f546869732069732061207465737421")
	tstProposalAreaPacketBytes    = mustDecodeString("0aaa0508011ad1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7922d1020a240990140b374b523354118e5d5b22061dba07194c836918047a135321c7c5eb2bb06058ff100120becaadeb052a003224099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc3a24099afd0ff99146080a116d7b324876b49dc019ad8b3895ad3453f121cb826f3f96db9ebc4224096acdfd510544639611d103001bfab150da19540b82554994c79b219979aba7b99e56ab4a080a06b5e620f4800052240992d5d69f2d1bb95e11095569f01096cc0c193e69ab4f76cf0cb621f0e3f1edf212b1ca5a230a2102c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9c620e0a04acc599961204944f0116182072480a46304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a791215080110021a0f5468697320697320612074657374211215080110021a0f546869732069732061207465737421")
	tstProposalAreaPlainBytes     = mustDecodeString("010000000000000090140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7990140b374b5233548e5d5b22061dba074c836918047a1353c7c5eb2bb06058ff010000000000000000000000000000003e656b5d0000000000000000000000000000000000000000000000000000000000000000000000009afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc9afd0ff99146080a6d7b324876b49dc0ad8b3895ad3453f1cb826f3f96db9ebc6acdfd5105446396d103001bfab150da540b82554994c79b9979aba7b99e56abb5e620f4800092d5d69f2d1bb95e095569f01096cc0c3e69ab4f76cf0cb6f0e3f1edf212b1ca02c121b2bb27f8af5b365f1c0d9e02c2044a731aad6d0a6951ab3af506a3792c9cacc59996944f011620000000304402204ab4d572324785f59119a5dce949a47edb5b05cbf065e255510c23bcc9f0c133022027242ece09dee99ef19fa22d72a85a3db0662da1605300ae7610f03eab1d1a7901000000020000005468697320697320612074657374210100000002000000546869732069732061207465737421")
	tstProposalAreaIDBytes        = mustDecodeString("")
	tstProposalAreaWitnessIDBytes = mustDecodeString("")
	tstProposalAreaPoCIDBytes     = mustDecodeString("")
	tstProposalAreaChainIDBytes   = mustDecodeString("")
)

func TestCodecMode_Decode(t *testing.T) {
	var fpk = &FaultPubKey{
		version:   ProposalVersion,
		PubKey:    tstGenesisHeader.PubKey,
		Testimony: [2]*BlockHeader{&tstGenesisHeader, &tstGenesisHeader},
	}
	var np = &NormalProposal{
		version:      ProposalVersion,
		proposalType: typeAnyMessage,
		content:      []byte("This is a test!"),
	}

	tests := []*struct {
		allowed        []CodecMode
		allowedData    [][]byte
		notAllowed     []CodecMode
		notAllowedData [][]byte
		newMsg         func() Message
		preImage       Message
	}{
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstGenesisHeaderDBBytes, tstGenesisHeaderPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstGenesisHeaderPlainBytes, tstGenesisHeaderIDBytes, tstGenesisHeaderWitnessIDBytes, tstGenesisHeaderPoCIDBytes, tstGenesisHeaderChainIDBytes},
			newMsg:         func() Message { return new(BlockHeader) },
			preImage:       &tstGenesisHeader,
		},
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstFaultPubKeyDBBytes, tstFaultPubKeyPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstFaultPubKeyPlainBytes, tstFaultPubKeyIDBytes, tstFaultPubKeyWitnessIDBytes, tstFaultPubKeyPoCIDBytes, tstFaultPubKeyChainIDBytes},
			newMsg:         func() Message { return new(FaultPubKey) },
			preImage:       fpk,
		},
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstGenesisBlockDBBytes, tstGenesisBlockPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstGenesisBlockPlainBytes, tstGenesisBlockIDBytes, tstGenesisBlockWitnessIDBytes, tstGenesisBlockPoCIDBytes, tstGenesisBlockChainIDBytes},
			newMsg:         func() Message { return new(MsgBlock) },
			preImage:       &tstGenesisBlock,
		},
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstMsgTxDBBytes, tstMsgTxPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstMsgTxPlainBytes, tstMsgTxIDBytes, tstMsgTxWitnessIDBytes, tstMsgTxPoCIDBytes, tstMsgTxChainIDBytes},
			newMsg:         func() Message { return new(MsgTx) },
			preImage:       &tstGenesisCoinbaseTx,
		},
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstNormalProposalDBBytes, tstNormalProposalPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstNormalProposalPlainBytes, tstNormalProposalIDBytes, tstNormalProposalWitnessIDBytes, tstNormalProposalPoCIDBytes, tstNormalProposalChainIDBytes},
			newMsg:         func() Message { return new(NormalProposal) },
			preImage:       np,
		},
		{
			allowed:        []CodecMode{DB, Packet},
			allowedData:    [][]byte{tstProposalAreaDBBytes, tstProposalAreaPacketBytes},
			notAllowed:     []CodecMode{Plain, ID, WitnessID, PoCID, ChainID},
			notAllowedData: [][]byte{tstProposalAreaPlainBytes, tstProposalAreaIDBytes, tstProposalAreaWitnessIDBytes, tstProposalAreaPoCIDBytes, tstProposalAreaChainIDBytes},
			newMsg:         func() Message { return new(ProposalArea) },
			preImage: &ProposalArea{
				PunishmentArea: []*FaultPubKey{fpk},
				OtherArea:      []*NormalProposal{np, np},
			},
		},
	}

	for i, test := range tests {
		for j, mode := range test.allowed {
			msg := test.newMsg()
			if err := msg.SetBytes(test.allowedData[j], mode); err != nil {
				t.Errorf("%d, Decode CodecMode fail, mode = %v, err = %v", i, mode, err)
			} else if !reflect.DeepEqual(msg, test.preImage) {
				t.Errorf("%d, Decode CodecMode not equal, mode = %v", i, mode)
			}
		}
		for j, mode := range test.notAllowed {
			if err := test.newMsg().SetBytes(test.notAllowedData[j], mode); err != ErrInvalidCodecMode {
				t.Errorf("%d, Decode CodecMode is allowed, mode = %v, got = %v", i, mode, err)
			}
		}
	}
}

func TestCodecMode_Encode(t *testing.T) {
	var fpk = &FaultPubKey{
		version:   ProposalVersion,
		PubKey:    tstGenesisHeader.PubKey,
		Testimony: [2]*BlockHeader{&tstGenesisHeader, &tstGenesisHeader},
	}
	var np = &NormalProposal{
		version:      ProposalVersion,
		proposalType: typeAnyMessage,
		content:      []byte("This is a test!"),
	}

	tests := []*struct {
		allowed     []CodecMode
		allowedData [][]byte
		notAllowed  []CodecMode
		msg         Message
	}{
		{
			allowed:     []CodecMode{DB, Packet, Plain, ID, PoCID, ChainID},
			allowedData: [][]byte{tstGenesisHeaderDBBytes, tstGenesisHeaderPacketBytes, tstGenesisHeaderPlainBytes, tstGenesisHeaderIDBytes, tstGenesisHeaderPoCIDBytes, tstGenesisHeaderChainIDBytes},
			notAllowed:  []CodecMode{WitnessID},
			msg:         &tstGenesisHeader,
		},
		{
			allowed:     []CodecMode{DB, Packet, Plain, ID},
			allowedData: [][]byte{tstFaultPubKeyDBBytes, tstFaultPubKeyPacketBytes, tstFaultPubKeyPlainBytes, tstFaultPubKeyIDBytes},
			notAllowed:  []CodecMode{WitnessID, PoCID, ChainID},
			msg:         fpk,
		},
		{
			allowed:     []CodecMode{DB, Packet, Plain},
			allowedData: [][]byte{tstGenesisBlockDBBytes, tstGenesisBlockPacketBytes, tstGenesisBlockPlainBytes},
			notAllowed:  []CodecMode{ID, WitnessID, PoCID, ChainID},
			msg:         &tstGenesisBlock,
		},
		{
			allowed:     []CodecMode{DB, Packet, Plain, ID, WitnessID},
			allowedData: [][]byte{tstMsgTxDBBytes, tstMsgTxPacketBytes, tstMsgTxPlainBytes, tstMsgTxIDBytes, tstMsgTxWitnessIDBytes},
			notAllowed:  []CodecMode{PoCID, ChainID},
			msg:         &tstGenesisCoinbaseTx,
		},
		{
			allowed:     []CodecMode{DB, Packet, Plain, ID},
			allowedData: [][]byte{tstNormalProposalDBBytes, tstNormalProposalPacketBytes, tstNormalProposalPlainBytes, tstNormalProposalIDBytes},
			notAllowed:  []CodecMode{WitnessID, PoCID, ChainID},
			msg:         np,
		},
		{
			allowed:     []CodecMode{DB, Packet, Plain},
			allowedData: [][]byte{tstProposalAreaDBBytes, tstProposalAreaPacketBytes, tstProposalAreaPlainBytes},
			notAllowed:  []CodecMode{ID, WitnessID, PoCID, ChainID},
			msg: &ProposalArea{
				PunishmentArea: []*FaultPubKey{fpk},
				OtherArea:      []*NormalProposal{np, np},
			},
		},
	}

	for i, test := range tests {
		for j, mode := range test.allowed {
			if result, err := test.msg.Bytes(mode); err != nil {
				t.Errorf("%d, Encode CodecMode fail, mode = %v, err = %v", i, mode, err)
			} else if !bytes.Equal(result, test.allowedData[j]) {
				t.Errorf("%d, Encode CodecMode not equal, mode = %v, want = %s", i, mode, hex.EncodeToString(result))
			}
		}
		for _, mode := range test.notAllowed {
			if _, err := test.msg.Bytes(mode); err != ErrInvalidCodecMode {
				t.Errorf("%d, Encode is allowed, mode = %v, got = %v", i, mode, err)
			}
		}
	}
}
